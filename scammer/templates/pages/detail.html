{% extends 'parent/base.html' %}
{% block title %}detail{% endblock %}
{% load static %}



{% block content %}
<div class="shop-detail-content mx-auto my-5" style="max-width: 1000px; text-align: center;">

  <!-- Ø¹Ù†ÙˆØ§Ù† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
  <h1 class="display-4 fw-bold text-primary mb-4">{{ shop.name }}</h1>

  {% if shop.images.count > 0 %}

    {% if shop.images.count == 1 %}
      <!-- ÙÙ‚Ø· ÛŒÚ© ØªØµÙˆÛŒØ± -->
      {% with img=shop.images.first %}
        <div class="single-img mb-4">
          {% if img.img_file %}
            <img src="{{ img.img_file.url }}" alt="{{ img.title|default:'ØªØµÙˆÛŒØ±' }}" style="width:100%; max-width:900px; height:auto; object-fit:contain; border-radius:12px;">
          {% else %}
            <img src="{% static 'placeholder.png' %}" alt="Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±" style="width:100%; max-width:900px; height:auto; object-fit:contain; border-radius:12px;">
          {% endif %}
        </div>
      {% endwith %}

    {% else %}
      <!-- Ú¯Ø§Ù„Ø±ÛŒ Ú†Ù†Ø¯ ØªØµÙˆÛŒØ± 3 Ø³ØªÙˆÙ†Ù‡ -->
      <div class="grid-gallery mb-4" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; justify-items:center;">
        {% for img in shop.images.all %}
          <div class="grid-item">
            {% if img.img_file %}
              <img src="{{ img.img_file.url }}" alt="{{ img.title|default:'ØªØµÙˆÛŒØ±' }}" style="width:100%; max-width:300px; height:220px; object-fit:cover; border-radius:12px;">
            {% else %}
              <img src="{% static 'placeholder.png' %}" alt="Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±" style="width:100%; max-width:300px; height:220px; object-fit:cover; border-radius:12px;">
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}

  {% else %}
    <p class="text-center text-muted fs-5 mt-4">Ù‡ÛŒÚ† ØªØµÙˆÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</p>
  {% endif %}
     <!-- ØªØ§Ø±ÛŒØ® Ùˆ Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ -->
    <div class="meta-info d-flex justify-content-between text-muted small mx-auto" style="max-width:300px;">
      <span>{{ shop.images.first.created|date:"Y-m-d H:i" }}</span>
      <span>{{ shop.author.username }}</span>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
    <div class="feedback-wrapper mb-4">
      <p class="fs-4 fw-semibold text-dark mb-3">Ø¢ÛŒØ§ Ø§Ø² Ø§ÛŒÙ† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±Ø§Ø¶ÛŒ Ù‡Ø³ØªÛŒØ¯ØŸ</p>
      <div class="feedback-buttons" data-shop-id="{{ shop.id }}" style="display:flex; justify-content:center; gap:1rem;">
        <button type="button" class="feedback-btn like" style="background-color:#198754; color:white; border:none; border-radius:999px; padding:.5rem 1.25rem; font-weight:600; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.08);">ğŸ‘ <span class="like-count">{{ shop.like.count }}</span></button>
        <button type="button" class="feedback-btn dislike" style="background-color:#dc3545; color:white; border:none; border-radius:999px; padding:.5rem 1.25rem; font-weight:600; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.08);">ğŸ‘ <span class="dislike-count">{{ shop.dislike.count }}</span></button>
      </div>
    </div>

        <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± -->
    <div class="description-box mb-4" style="background-color:#f8f9fa; padding:16px 24px; border-radius:12px;">
        <p>{{ shop.description }}</p>
    </div>


</div>
<!-- Comment Section -->
<div class="comments-section" style="max-width:800px; margin:40px auto; text-align:right; font-family:sans-serif;">
    <h2 style="margin-bottom:20px; color:#2c3e50;">Ù†Ø¸Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>

    <!-- Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ -->
    <div class="comments-list" style="margin-bottom:30px;">
        {% if comments %}
            {% for c in comments %}
            <div class="comment" style="border:1px solid #ccc; padding:10px 15px; margin-bottom:10px; border-radius:8px; background-color:#f9f9f9;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <strong>{{ c.author.username }}</strong>
                    <small style="color:#777;">{{ c.created|date:"Y-m-d H:i" }}</small>
                </div>
                <div style="white-space:pre-wrap;">{{ c.text }}</div>
            </div>
            {% endfor %}
        {% else %}
            <p style="color:#777;">Ù‡ÛŒÚ† Ù†Ø¸Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
        {% endif %}
    </div>

    <!-- ÙØ±Ù… Ú©Ø§Ù…Ù†Øª -->
    {% if user.is_authenticated %}
    <div class="comment-form" style="border:1px solid #ccc; padding:15px; border-radius:8px; background-color:#eee;">
        <h4 style="margin-bottom:10px;">Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯</h4>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" style="margin-top:10px; padding:8px 16px; border:none; border-radius:6px; background-color:#2c3e50; color:white; cursor:pointer;">
                Ø§Ø±Ø³Ø§Ù„ Ú©Ø§Ù…Ù†Øª
            </button>
        </form>
    </div>
    {% else %}
        <p style="color:#777; text-align:center;">Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±ØŒ Ù„Ø·ÙØ§Ù‹ <a href="{% url 'login' %}">ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</a>.</p>
    {% endif %}
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    $(document).ready(function () {
        $('.feedback-btn.like').click(function () {
            var shop_id = $(this).closest('.feedback-buttons').data('shop-id');
            var likecountspan = $(this).closest('.feedback-buttons').find('.like-count');
            var dislikecountspan = $(this).closest('.feedback-buttons').find('.dislike-count');

            $.ajax({
                type: 'POST',
                url: '{% url 'scam:like_shop' %}',
                data: {'shop_id': shop_id, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success: function(data) {
                    likecountspan.text(data.likes_count);
                    dislikecountspan.text(data.dislikes_count);

                }

            });
        });

        $('.feedback-btn.dislike').click(function () {
            var shop_id = $(this).closest('.feedback-buttons').data('shop-id');
            var likecountspan = $(this).closest('.feedback-buttons').find('.like-count');
            var dislikecountspan = $(this).closest('.feedback-buttons').find('.dislike-count');

            $.ajax({
                type: 'POST',
                url: '{% url 'scam:dislike_shop' %}',
                data: {'shop_id': shop_id, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success: function(data) {
                    likecountspan.text(data.likes_count);
                    dislikecountspan.text(data.dislikes_count);
                }

            });
        });
    });
</script>

{% endblock %}